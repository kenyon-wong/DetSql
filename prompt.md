你的任务是帮我维护 DetSql 项目，优先使用 mcp、深度思考、子代理来帮我分析、确认和完善如下todo：

TODO list:

## 待实施的优化任务 🚀

### 优先级 P2（暂缓实施）

#### 长期架构重构（可选）
**状态**: ⏸️ 暂缓
**优先级**: P2（长期优化）
**实施成本**: 1-2周

**重构目标**: 三层数据模型
- `TestContext`（测试上下文，测完即丢）
- `ScanResult`（扫描结果，仅元信息）
- `VulnerabilityEvidence`（漏洞证据，仅漏洞）

**触发条件**:
- 内存问题频繁发生
- 短期修复无法满足需求
- 项目进入稳定期

**参考文档**: `.agent/compromise-strategy-analysis.md` 阶段2方案

---

## 不建议实施的任务 ❌

### 1. 性能优化（大部分方案）
**状态**: ❌ 暂不实施
**原因**:
- 无明确性能瓶颈
- 可能引入复杂性
- 作为未来参考保留

**参考文档**: `.agent/optimization-strategy.md`（标注为参考性文档）

---

## 任务优先级说明

**P0（推荐立即实施）**:
- ✅ 解决严重问题（内存泄漏）
- ✅ 高价值、低风险（进度统计）
- ✅ 实施成本低（几小时到1-2天）

**P1（可选实施）**:
- 优化用户体验
- 中等收益
- 可根据实际需求决定

**P2（暂缓实施）**:
- 长期优化方案
- 仅在遇到瓶颈时考虑
- 需要较大投入（1-2周）

---

## 推荐的实施顺序

### ✅ 已完成的优化（2025-10-12）

1. ✅ **进度统计功能**（35分钟，P0任务）
   - commit `26d0d67`
   - 实时显示已测试数量和漏洞数量

2. ✅ **内存泄漏修复**（1-2天，P0任务）
   - commit `26d0d67`
   - 内存占用减少77%（57.5MB → 13.5MB）

3. ✅ **参数过滤优化**（1小时，P1任务）
   - commit `df654b8`
   - 节省10-30%不必要测试

4. ✅ **Commit 描述修正**（1小时）
   - 修正 commit 24e6ece → 26d0d67
   - 修正 commit efd52c0 → df654b8

### 下一步建议

目前所有已识别的 P0 和 P1 优化任务均已完成。如果未来遇到以下情况，可以考虑：

1. **性能瓶颈**: 参考 `.agent/optimization-strategy.md` 中的 P0-P2 优化方案
2. **内存问题仍然严重**: 考虑三层数据模型重构（参考 `.agent/compromise-strategy-analysis.md` 阶段2）
3. **代码维护困难**: 等项目稳定后，考虑 `processRequestInternal()` 重构

rules:

你可以访问当前的 DetSql 代码库。

- workflow：先读取和理解任务，然后调用 task tool 进行深度思考，对任务进行分析、确认和澄清，最后通过 task tool 调用 java_pro 子代理完整代码更新
- 使用 .agent/ 目录作为工作暂存区，在此存储长期计划和待办事项列表。
- 创建 TodoWrite 来追踪任务
- 优先使用 mcp、深度思考和子代理
- 按优先级处理问题
- 按照原子化变更的方式，最小修改代码，完成 TODO
- 如果task之间不冲突则优先并行调用子代理
- 每次编辑文件后都需要使用子代理调用 `/commit` 斜杠命令提交并推送更改

你需要为项目编写端到端测试和单元测试。但请确保将大部分时间用于实际工作而非测试，建议的时间分配比例是：80% 用于实际更新，20% 于测试。


